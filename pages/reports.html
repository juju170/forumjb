<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laporan Warga ğŸš¨</title>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <main class="admin-container">
    <h2>ğŸš¨ Daftar Laporan Warga</h2>
    <p style="color:#666;">Berikut laporan yang dikirim oleh warga terhadap postingan.</p>
    <div id="reportList" class="report-list">
      <p>Memuat laporan...</p>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // âš™ï¸ Config Firebase kamu (copy dari app.js)
    const firebaseConfig = {
      apiKey: "AIzaSyC8uiIvWOZPcSZOzCGnlRMA7WJ7TIQfy5s",
    authDomain: "tts-indonesia-bf14e.firebaseapp.com",
    projectId: "tts-indonesia-bf14e",
    storageBucket: "tts-indonesia-bf14e.firebasestorage.app",
    messagingSenderId: "240052198349",
    appId: "1:240052198349:web:112553f8ca408b2fcc4284",
    measurementId: "G-KSN1NV6V4J"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const reportList = document.getElementById("reportList");

    async function loadReports() {
      reportList.innerHTML = "<p>ğŸ“‚ Mengambil data laporan...</p>";
      const snapshot = await getDocs(collection(db, "reports"));
      if (snapshot.empty) {
        reportList.innerHTML = "<p style='color:#999;'>Belum ada laporan.</p>";
        return;
      }

      reportList.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;

        const card = document.createElement("div");
        card.classList.add("report-card");
        card.innerHTML = `
          <div class="report-info">
            <p><b>ğŸ“„ Post ID:</b> ${data.postId}</p>
            <p><b>ğŸ‘¤ Pelapor:</b> ${data.reporter}</p>
            <p><b>ğŸ—’ï¸ Alasan:</b> ${data.reason}</p>
            <p><b>ğŸ•’ Waktu:</b> ${new Date(data.time).toLocaleString("id-ID")}</p>
          </div>
          <button class="delete-report">Hapus</button>
        `;

        card.querySelector(".delete-report").addEventListener("click", async () => {
          if (!confirm("Yakin mau hapus laporan ini?")) return;
          await deleteDoc(doc(db, "reports", id));
          card.remove();
          alert("âœ… Laporan dihapus!");
        });

        reportList.appendChild(card);
      });
    }

    loadReports();
  </script>
</body>
</html>
